from flask import Flask, request, send_file, jsonify
import yt_dlp
import os

app = Flask(__name__)

@app.route("/")
def home():
    return jsonify({"message": "YouTube audio proxy is running"})

@app.route("/download")
def download_audio():
    video_url = request.args.get("url")
    if not video_url:
        return jsonify({"error": "Missing YouTube URL parameter ?url="}), 400

    try:
        filename = "audio.mp3"
        ydl_opts = {
            "format": "bestaudio/best",
            "outtmpl": filename,
            "quiet": True,
        }

        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            ydl.download([video_url])

        return send_file(filename, as_attachment=True)

    except Exception as e:
        return jsonify({"error": str(e)}), 500
